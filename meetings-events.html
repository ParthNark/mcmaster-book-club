<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetings & Events â€“ McMaster Book Club</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://openlibrary.org">
    <link rel="preconnect" href="https://covers.openlibrary.org">
    <link rel="preconnect" href="https://script.google.com">
    <link rel="preconnect" href="https://script.googleusercontent.com">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="js/api.js"></script>
    <script src="js/openlibrary.js"></script>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Navigation Bar (consistent with other pages) -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html"><img src="images/logo.png" alt="McMaster Book Club logo" class="nav-logo-img"> McMaster Book Club</a>
            </div>
            <button class="hamburger" id="hamburger" aria-label="Toggle navigation" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item"><a href="index.html#home" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="index.html#about" class="nav-link">About</a></li>
                <li class="nav-item"><a href="current-read.html" class="nav-link">Current Read</a></li>
                <li class="nav-item"><a href="meetings-events.html" class="nav-link nav-link-active">Meetings & Events</a></li>
                <li class="nav-item"><a href="index.html#join" class="nav-link nav-link-cta">Join Us</a></li>
            </ul>
        </div>
    </nav>

    <main id="main-content">
        <!-- Page Hero -->
        <section class="page-hero">
            <div class="container">
                <h1>ğŸ“… Meetings & Events</h1>
                <p>Stay up to date with our monthly picks, meeting times, and upcoming events.</p>
            </div>
        </section>

        <!-- Monthly Picks Section -->
        <section class="section meetings-events-section">
            <div class="container">
                <div class="me-subsection">
                    <h2 class="me-subheading">ğŸ“– Monthly Picks</h2>
                    <p id="me-picks-loading" class="hw-loading">Loading monthly picksâ€¦</p>
                    <div class="me-picks-grid" id="me-picks-grid" style="display:none;"></div>
                    <div id="me-picks-error" class="error-state" style="display:none;">Unable to load monthly picks right now.</div>
                </div>
            </div>
        </section>

        <!-- Upcoming Events Section -->
        <section class="section meetings-events-section">
            <div class="container">
                <div class="me-subsection">
                    <h2 class="me-subheading">ğŸ‰ Upcoming Events</h2>
                    <p id="me-events-loading" class="hw-loading">Loading eventsâ€¦</p>
                    <div id="me-events-container" style="display:none;"></div>
                    <div id="me-events-error" class="error-state" style="display:none;">Unable to load events right now.</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer (consistent with other pages) -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>McMaster Book Club</h4>
                <p>Building community through the love of reading.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html#home">Home</a></li>
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="current-read.html">Current Read</a></li>
                    <li><a href="meetings-events.html">Meetings & Events</a></li>
                    <li><a href="index.html#join">Join Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Connect</h4>
                <div class="footer-social">
                    <a href="https://www.instagram.com/mcmasterbooks/" target="_blank" rel="noopener" aria-label="Instagram" class="footer-social-link">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <rect width="24" height="24" fill="none"/>
                            <rect x="2" y="2" width="20" height="20" rx="4.18" ry="4.18" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3.6" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="18.5" cy="5.5" r="1.5" fill="currentColor"/>
                        </svg>
                    </a>
                    <a href="https://linktr.ee/mcmasterbooks" target="_blank" rel="noopener" aria-label="Linktree" class="footer-social-link">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.953 15.066l-.038-4.18 4.058-.002v13.12h.076V10.882l4.058.002-.038 4.18 4.354-4.1-1.476-1.58-2.762 2.608.038-5.238h3.4L12 0 4.553 6.754h3.4l.038 5.238-2.762-2.608-1.476 1.58 4.2 4.102z" fill="currentColor"/>
                        </svg>
                    </a>
                    <a href="#" aria-label="Discord" class="footer-social-link">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.317 4.3671c-1.8345-.8954-3.970-.4383-3.970-.4383l-.195.234c2.3825.7234 3.5175 1.7622 3.5175 1.7622-1.5-.7372-2.9906-1.0972-4.4131-1.2237-.9035-.1117-1.7885-.0835-2.6059.0619 0 0 .137-.1618.4147-.3953-1.6365-.247-3.0992.1584-3.0992.1584s1.1246 1.0369 3.5042 1.7397v-.01c.4725.5648.9451 1.1295 1.3175 1.7622.6234 1.1293.9935 2.4627.9935 3.7961 0 0-.5589 1.1947-2.1768 1.5921 0 0 .1302.1618.4147.1618 1.3175 0 2.1768-.9452 2.1768-.9452.1302 1.2564-.3897 2.511-1.1246 3.4294-.6234.7371-1.5588 1.2565-2.5233 1.3441.5878.4665 1.3175.7919 2.1768.8238.8592.0318 1.7593-.1319 2.5233-.4665.7641-.3346 1.5281-.8874 2.0765-1.55-.3897 2.511-2.6059 4.3671-5.2118 4.3671-1.3175 0-2.5233-.3345-3.5175-1.0369.2914-.1938.5878-.3884.8813-.5829 1.5-.9451 2.8537-2.3758 3.6227-4.0328.7641-1.657 1.0285-3.4933.7641-5.2936-.2645-1.8003-.7641-3.494-1.8345-4.9575z" fill="currentColor"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 McMaster Book Club. All rights reserved. Made with <span class="heart">â¤ï¸</span> for book lovers.</p>
        </div>
    </footer>

    <script>
        // â”€â”€â”€ Mobile menu toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var hamburger = document.getElementById('hamburger');
        var navMenu = document.getElementById('nav-menu');

        hamburger.addEventListener('click', function () {
            navMenu.classList.toggle('active');
            hamburger.setAttribute('aria-expanded',
                hamburger.getAttribute('aria-expanded') === 'false' ? 'true' : 'false'
            );
        });

        document.querySelectorAll('.nav-link').forEach(function (link) {
            link.addEventListener('click', function () {
                navMenu.classList.remove('active');
                hamburger.setAttribute('aria-expanded', 'false');
            });
        });

        document.addEventListener('click', function (e) {
            if (!e.target.closest('.nav-container')) {
                navMenu.classList.remove('active');
                hamburger.setAttribute('aria-expanded', 'false');
            }
        });

        /** Escape HTML entities to prevent XSS */
        function _esc(str) {
            var d = document.createElement('div');
            d.appendChild(document.createTextNode(str));
            return d.innerHTML;
        }

        // â”€â”€â”€ Monthly Picks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        (async function () {
            var loadingEl = document.getElementById('me-picks-loading');
            var gridEl    = document.getElementById('me-picks-grid');
            var errorEl   = document.getElementById('me-picks-error');

            try {
                var config;
                if (typeof getCurrent === 'function' &&
                    typeof API_BASE !== 'undefined' &&
                    API_BASE !== 'PASTE_WEB_APP_URL_HERE') {
                    config = await getCurrent();
                    if (!config || config.error) throw new Error('API error');
                } else {
                    var res = await fetch('data/current.json');
                    if (!res.ok) throw new Error('Local JSON failed');
                    config = await res.json();
                }

                var books = config.books || [];
                if (books.length === 0) throw new Error('No books in response');

                var olPromises = books.map(function (b) { return fetchBookFromOpenLibrary(b); });
                var olResults  = await Promise.all(olPromises);

                var html = '';
                for (var i = 0; i < books.length; i++) {
                    var bk   = books[i];
                    var book = olResults[i];
                    var bookId = bk.id || ('book' + (i + 1));

                    var title = _esc(book.title || bk.title || 'TBA');
                    var authorText = (book.authors && book.authors.length > 0)
                        ? 'by ' + _esc(book.authors.join(', '))
                        : (bk.author ? 'by ' + _esc(bk.author) : '');
                    var coverSrc = book.coverUrl || 'images/current-book-cover.png';

                    html += '<article class="me-pick-card">'
                        + '<div class="me-pick-cover"><img src="' + coverSrc + '" alt="Cover of ' + title + '" onerror="this.onerror=null;this.src=\'images/current-book-cover.png\';"></div>'
                        + '<div class="me-pick-info">'
                        +   '<h4 class="me-pick-title">' + title + '</h4>'
                        +   '<p class="me-pick-author">' + authorText + '</p>'
                        +   '<div class="me-pick-meeting">'
                        +     '<p>ğŸ“… <strong>' + _esc(bk.meeting_time || 'TBA') + '</strong></p>'
                        +     '<p>ğŸ“ ' + _esc(bk.meeting_location || 'TBA') + '</p>'
                        +     (bk.meeting_notes ? '<p class="me-pick-notes">' + _esc(bk.meeting_notes) + '</p>' : '')
                        +   '</div>'
                        +   '<a href="current-read.html#' + bookId + '" class="btn btn-secondary me-pick-details-btn">View details â†’</a>'
                        + '</div>'
                        + '</article>';
                }

                if (loadingEl) loadingEl.style.display = 'none';
                gridEl.innerHTML = html;
                gridEl.style.display = '';

            } catch (e) {
                console.warn('Monthly picks load error:', e);
                if (loadingEl) loadingEl.style.display = 'none';
                if (errorEl)   errorEl.style.display = 'block';
            }
        })();

        // â”€â”€â”€ Upcoming Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        (async function () {
            var loadingEl   = document.getElementById('me-events-loading');
            var containerEl = document.getElementById('me-events-container');
            var errorEl     = document.getElementById('me-events-error');

            try {
                if (typeof getEvents !== 'function' ||
                    typeof API_BASE === 'undefined' ||
                    API_BASE === 'PASTE_WEB_APP_URL_HERE') {
                    throw new Error('API not configured');
                }

                var events = await getEvents();
                if (!Array.isArray(events) || events.length === 0) {
                    throw new Error('No events');
                }

                var html = '<div class="me-events-grid">';
                events.forEach(function (ev) {
                    html += '<article class="me-event-card">';
                    html += '<h4 class="me-event-title">' + _esc(ev.title || 'Untitled Event') + '</h4>';
                    if (ev.date || ev.time) {
                        html += '<p class="me-event-datetime">';
                        if (ev.date) html += 'ğŸ“… ' + _esc(ev.date);
                        if (ev.time) html += (ev.date ? ' Â· ' : '') + 'â° ' + _esc(ev.time);
                        html += '</p>';
                    }
                    if (ev.location) {
                        html += '<p class="me-event-location">ğŸ“ ' + _esc(ev.location) + '</p>';
                    }
                    if (ev.description) {
                        html += '<p class="me-event-desc">' + _esc(ev.description) + '</p>';
                    }
                    if (ev.instagram_embed_url && ev.instagram_embed_url.trim()) {
                        html += '<a href="' + _esc(ev.instagram_embed_url) + '" target="_blank" rel="noopener" class="btn btn-secondary me-event-ig-btn">ğŸ“¸ View on Instagram</a>';
                    }
                    if (ev.rsvp_url && ev.rsvp_url.trim()) {
                        html += '<a href="' + _esc(ev.rsvp_url) + '" target="_blank" rel="noopener" class="btn btn-primary me-event-rsvp-btn">RSVP</a>';
                    }
                    html += '</article>';
                });
                html += '</div>';

                if (loadingEl) loadingEl.style.display = 'none';
                containerEl.innerHTML = html;
                containerEl.style.display = '';

            } catch (e) {
                console.warn('Events load error:', e);
                if (loadingEl) loadingEl.style.display = 'none';
                // Show a friendly "no events" message instead of error
                containerEl.innerHTML = '<p class="me-no-events">No upcoming events right now â€” check back soon or follow us on <a href="https://www.instagram.com/mcmasterbooks/" target="_blank" rel="noopener" class="inline-link">Instagram</a>!</p>';
                containerEl.style.display = '';
            }
        })();
    </script>
</body>
</html>
